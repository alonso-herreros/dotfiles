[user]
    email = alonso.herreros.c@gmail.com
    name = Alonso Herreros

[core]
    editor = vim
    pager = less -FRXx5,9

[alias]
    # ---- Init and management ----
    i    = init

    su   = submodule
    suu  = submodule update --init
    suur = submodule update --init --recursive
    suuu = submodule update --init --recursive
    sum  = submodule foreach "git checkout main; git reset --hard"

    # ---- Informational: status, log, diff, show ----

    # Taken: `st` for `stash`, `su` for `submodule`, `sh` for `show`
    s    = status -sb
    ss   = status --short
    sl   = status

    l    = log --oneline               # Log (oneline by default)
    ls   = log --oneline -n 10         # Log short
    la   = log --oneline --all --graph # Log all (in graph)
    las  = log --oneline --all --graph -n 10 # Log all short (in graph)
    ll   = log                         # Log long (with details)
    lla  = log --all --graph           # Log long all (graph, with details)
    # Log interactive (with preview)
    li   = "!git l   --oneline --color=always | git fzfp \"$@\""
    lai  = "!git la  --oneline --color=always | git fzfp \"$@\""
    lsi  = "!git ls  --oneline --color=always | git fzfp \"$@\""
    lasi = "!git las --oneline --color=always | git fzfp \"$@\""
    # Helper for fzf-based commit selection
    fzfp = "!gfzfp() { fzf \
            --multi --ansi \
            --layout=reverse-list \
            --header=\"${1:-Browse commits}\" \
            --preview='git show --patch-with-stat --color=always \
                $(echo {} | grep -o \"[0-9a-f]\\{7\\}\")' \
            --preview-window=hidden \
            --bind='alt-p:toggle-preview' | \
        grep -o '[0-9a-f]\\{7\\}' | \
        paste -s; \
    }; gfzfp"


    d    = diff
    ds   = diff --cached
    dst  = diff --stat
    dm   = diff main
    dmst = diff main --stat

    sh   = show
    shh  = "!git show $(git lai)"
    shs  = show --stat
    shhs = "!git show --stat $(git lai)"

    # ---- Index operations: add, restore ----

    a    = add
    aa   = add -A
    ap   = add --patch

    # Taken: `rb` for `rebase`, `rv` and `ra` for `remote`
    r    = restore
    rr   = restore .
    rp   = restore --patch
    rs   = restore --staged
    rrs  = restore . --staged
    rsp  = restore --staged --patch
    rrr  = reset --hard

    # ---- Commits and stashes ----

    # Taken: `co` and `c-` for `checkout`, `cp` for `cherry-pick`
    c    = commit
    cm   = commit -m
    cmp  = "!cmp()  { git commit -m \"$@\"; git push; }; cmp"
    cc   = "!cc()   { git add -A; git commit; }; cc"
    ccm  = "!ccm()  { git add -A; git commit -m \"$@\"; }; ccm"
    ccmp = "!ccmp() { git add -A; git commit -m \"$@\"; git push; }; ccmp"
    ca   = commit --amend
    cane = commit --amend --no-edit
    # Fixup
    cf   = "commit --fixup"
    cff  = "!git commit --fixup $(git li 'Select commit to fixup')"
    ccf  = "!ccf() { \
        git add -A; \
        git commit --fixup \"$@\"; \
    }; ccf"
    ccff = "!ccff() { \
        git add -A; \
        git commit --fixup $(git li 'Select commit to fixup'); \
    }; ccff"

    st   = stash
    stm  = stash -m
    stt  = stash --all
    sttm = stash --all -m
    stk  = stash --keep-index
    stkm = stash --keep-index -m
    sts  = stash push -S
    sta  = stash apply
    stl  = stash list
    stp  = stash pop
    std  = stash drop
    stsh = stash show

    # ---- Branch operations: checkout, branch, merge, rebase, tag ----

    co   = checkout
    coo  = "!git checkout $(git branch -a --color=always | fzf --ansi | sed 's/.* //;s#remotes/origin/##')"
    cob  = checkout -b
    c-   = checkout -
    com  = checkout main

    b    = branch
    ba   = branch -a
    bd   = branch -d
    br   = branch -r
    bl   = branch -l
    bla  = branch -la

    m    = merge
    me   = merge --edit
    mnc  = merge --no-ff --no-commit
    ms   = merge --squash
    mc   = merge --continue
    ma   = merge --abort
    mm   = merge main
    mom  = merge origin/main

    mt   = mergetool

    cp   = cherry-pick
    cpp  = "!git cherry-pick $(git lai 'Select commit(s) to cherry-pick')"
    cpnc = cherry-pick --no-commit
    cppnc= "!git cherry-pick --no-commit $(git lai 'Select commit(s) to cherry-pick')"
    cpa  = cherry-pick --abort
    cpc  = cherry-pick --continue

    rb   = rebase
    rbm  = rebase main
    rbom = rebase origin/main
    rba  = rebase --abort
    rbc  = rebase --continue
    rbs  = rebase --skip
    rbi  = rebase --interactive
    rbii = "!git rebase --interactive $(git lai 'Select commit to rebase onto')"

    t    = tag

    # ---- Remote operations: fetch, push, pull, remote ----

    f    = fetch
    fa   = fetch --all
    fp   = fetch --prune
    fap  = fetch --all --prune
    ff   = "!git fetch --all --prune && git branch -la"

    # Taken `pl` for `pull`
    p    = push
    pt   = push --tags
    pd   = push --dry-run
    pf   = push --force-with-lease
    pff  = push --force
    po   = push origin
    pu   = push upstream
    p-   = "!git push -q &"

    pl   = pull
    plr  = pull --rebase
    pla  = pull --autostash
    plar = pull --autostash --rebase
    plom = pull origin main
    plu  = pull upstream
    plur = pull upstream --rebase

    pnp  = "!git pull --rebase && git push"

    # Not to be confused with `reset` aliases, which also start with `r`
    re   = remote
    rev  = remote --verbose
    rea  = remote add
    reao = remote add origin

    # ---- Other chains ----

    fapla = "!git fetch --all --prune && git log --oneline --all --graph"
    fapbla = "!git fetch --all --prune && git branch -la"
    fapb  = "!git fetch --all --prune && git branch -la"

    compl = "!git checkout main && git pull origin main"
    compl- = "!git checkout main && git pull origin main && git checkout -"

    fapcompl = "!git fetch --all --prune && git checkout main && git pull origin main"
    fapcompl- = "!git fetch --all --prune && git checkout main && git pull origin main && git checkout -"


    # ---- Others ----

    uncommit = reset --soft HEAD^
    shit = uncommit
    unstage = resetÂ HEAD --
    ignore = update-index --asume-unchanged

[init]
    defaultBranch = main

[status]
    submoduleSummary = true

[log]
    date = human
    decorate = short
    abbrevCommit = true
    follow = true

[blame]
    blankBoundary = true
    coloring = repeatedLines
    date = human

[commit]
    verbose = true

[push]
    autoSetupRemote = true
    followTags = true

[pull]
    ff = only
    rebase = true

[rebase]
    autostash = true
    autosquash = true

[merge]
    stat = true
    conflictstyle = zdiff3
    tool = fugitive

[mergetool]
    tool = vimdiff
    hideResolve=true
    writeToTemp=true
    # prompt = false

[mergetool.vimdiff]
    layout = "LOCAL,REMOTE / MERGED + MERGED,REMOTE"

[mergetool.fugitive]
    cmd = vim -f -c "Gvdiffsplit!" "$MERGED"

[diff]
    algorithm = histogram
    colorMoved = default
    submodule = log

[submodule]
    recurse = true

[help]
    autocorrect = prompt

[advice]
    addIgnoredFile = false

[url "git@github.com:"]
    pushInsteadOf = "https://github.com/"
    insteadOf = "gh:"

[url "git@gitlab.com:"]
    pushInsteadOf = "https://gitlab.com/"
    insteadOf = "gl:"

# [diff "jupyternotebook"]
#     command = git-nbdiffdriver diff
# [merge "jupyternotebook"]
#     driver = git-nbmergedriver merge %O %A %B %L %P
#     name = jupyter notebook merge driver
# [difftool "nbdime"]
#     cmd = git-nbdifftool diff \"$LOCAL\" \"$REMOTE\" \"$BASE\"
# [difftool]
#     prompt = false
# [mergetool "nbdime"]
#     cmd = git-nbmergetool merge \"$BASE\" \"$LOCAL\" \"$REMOTE\" \"$MERGED\"

[include]
    path = config_local
    path = config.d/*

# vim: ft=gitconfig
